vrrp_sync_group <%= @name %>_group {
  group {
    <%= @name %>
  }

  notify_master /etc/keepalived/vrrp_master.sh
  notify_backup /etc/keepalived/vrrp_backup.sh
  notify_fault /etc/keepalived/vrrp_backup.sh
  notify /etc/keepalived/vrrp_state.sh
}

vrrp_instance <%= @name %> {
        state <%= @state %>
        interface <%= @interface %>
        virtual_router_id <%= @virtual_router_id %>
        priority <%= @real_priority %>
        advert_int 1
        smtp_alert
        authentication {
                auth_type PASS
                auth_pass <%= @auth_pass %>
        }

        virtual_ipaddress {
               <%= @virtual_ipaddress %>
        }
}

virtual_server <%= @virtual_ipaddress %> <%= @virtual_server_port %> {
    delay_loop 3
    lb_algo <%= @lb_algo %>
    lb_kind <%= @lb_kind %>
    nat_mask 255.255.255.0
    protocol TCP
}