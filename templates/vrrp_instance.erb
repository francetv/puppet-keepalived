vrrp_sync_group <%= @name %>_group {
  group {
<% @vip_address.each do |ip| %>
    <%= @name %>_<%= @ip %>
<% end %>
  }

  notify_master /etc/keepalived/vrrp_master.sh
  notify_backup /etc/keepalived/vrrp_backup.sh
  notify_fault /etc/keepalived/vrrp_backup.sh
  notify /etc/keepalived/vrrp_state.sh
}

<% @vip_address.each do |ip,state,router_id| %>
vrrp_instance <%= @name %>_<%= @ip %> {
        state <%= @state %>
        interface <%= @interface %>
        virtual_router_id <%= @router_id %>
        priority <%= @real_priority %>
        advert_int 1
        smtp_alert
        authentication {
                auth_type PASS
                auth_pass <%= @auth_pass %>
        }

        virtual_ipaddress {
               <%= @ip %>
        }
}
<% end %>