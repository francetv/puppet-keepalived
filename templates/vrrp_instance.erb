<% @vip.each do |ip| %>
vrrp_instance <%= @name %>_<%= ip['vip'] %> {
        state <%= ip['state'] %>
        interface <%= @interface %>
        lvs_sync_daemon_interface <%= @interface %>
        virtual_router_id <%= ip['router_id'] %>
        priority <%= ip['priority'] %>
        advert_int 1
        smtp_alert
        authentication {
                auth_type PASS
                auth_pass <%= @auth_pass %>
        }

        notify_master "/sbin/ip route add <%= ip['vip'] %> dev <%= @interface %>"
        notify_backup "/sbin/ip route del <%= ip['vip'] %> dev <%= @interface %>"
        notify_fault "/sbin/ip route del <%= ip['vip'] %> dev <%= @interface %>"
        notify /etc/keepalived/vrrp_state.sh

        virtual_ipaddress {
               <%= ip['vip'] %>
        }
}
<% end %>